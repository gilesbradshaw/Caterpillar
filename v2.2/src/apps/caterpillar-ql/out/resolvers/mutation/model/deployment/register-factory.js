"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _debug2 = _interopRequireDefault(require("debug"));

var _continueFactoryRegistration = _interopRequireDefault(require("./continue-factory-registration"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const debug = (0, _debug2.default)('caterpillarql:model:register-factory');

const registerFactory = (web3, registryContract, currentIndex, sortedElements, outputContracts, modelInfo) => {
  debug('------------------------------------------------------------------------');
  const factoryContract = new web3.eth.Contract(outputContracts[`${sortedElements[currentIndex].nodeName}_Factory`].abi);
  factoryContract.transactionConfirmationBlocks = 1;
  return web3.eth.personal.getAccounts().then(accounts => factoryContract.deploy({
    data: "0x" + outputContracts[`${sortedElements[currentIndex].nodeName}_Factory`].evm.bytecode.object
  }).send({
    from: accounts[0],
    gas: 4700000.
  }).then(contractF => (0, _continueFactoryRegistration.default)(web3, registryContract, currentIndex, sortedElements, outputContracts, contractF, modelInfo, registerFactory)));
};

var _default = registerFactory;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2FwcC9yZXNvbHZlcnMvbXV0YXRpb24vbW9kZWwvZGVwbG95bWVudC9yZWdpc3Rlci1mYWN0b3J5LnRzIl0sIm5hbWVzIjpbImRlYnVnIiwicmVnaXN0ZXJGYWN0b3J5Iiwid2ViMyIsInJlZ2lzdHJ5Q29udHJhY3QiLCJjdXJyZW50SW5kZXgiLCJzb3J0ZWRFbGVtZW50cyIsIm91dHB1dENvbnRyYWN0cyIsIm1vZGVsSW5mbyIsImZhY3RvcnlDb250cmFjdCIsImV0aCIsIkNvbnRyYWN0IiwiaWQiLCJub2RlTmFtZSIsImFiaSIsInRyYW5zYWN0aW9uQ29uZmlybWF0aW9uQmxvY2tzIiwicGVyc29uYWwiLCJnZXRBY2NvdW50cyIsInRoZW4iLCJhY2NvdW50cyIsImRlcGxveSIsImRhdGEiLCJldm0iLCJieXRlY29kZSIsIm9iamVjdCIsInNlbmQiLCJmcm9tIiwiZ2FzIiwiY29udHJhY3RGIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7Ozs7QUFFQSxNQUFNQSxLQUFLLEdBQUcscUJBQU8sc0NBQVAsQ0FBZDs7QUFFQSxNQUFNQyxlQUFlLEdBQUcsQ0FDdEJDLElBRHNCLEVBRXRCQyxnQkFGc0IsRUFHdEJDLFlBSHNCLEVBSXRCQyxjQUpzQixFQUt0QkMsZUFMc0IsRUFNdEJDLFNBTnNCLEtBT25CO0FBQ0hQLEVBQUFBLEtBQUssQ0FBQywwRUFBRCxDQUFMO0FBQ0EsUUFBTVEsZUFBZSxHQUFHLElBQUlOLElBQUksQ0FBQ08sR0FBTCxDQUFTQyxRQUFiLENBQXNCSixlQUFlLENBQUNDLFNBQVMsQ0FBQ0ksRUFBWCxDQUFmLENBQStCLEdBQUVOLGNBQWMsQ0FBQ0QsWUFBRCxDQUFkLENBQTZCUSxRQUFTLFVBQXZFLEVBQWtGQyxHQUF4RyxDQUF4QjtBQUNBTCxFQUFBQSxlQUFlLENBQUNNLDZCQUFoQixHQUFnRCxDQUFoRDtBQUNBLFNBQU9aLElBQUksQ0FBQ08sR0FBTCxDQUFTTSxRQUFULENBQWtCQyxXQUFsQixHQUNKQyxJQURJLENBRUhDLFFBQVEsSUFDTlYsZUFBZSxDQUNaVyxNQURILENBRUk7QUFDRUMsSUFBQUEsSUFBSSxFQUFFLE9BQU9kLGVBQWUsQ0FBQ0MsU0FBUyxDQUFDSSxFQUFYLENBQWYsQ0FBK0IsR0FBRU4sY0FBYyxDQUFDRCxZQUFELENBQWQsQ0FBNkJRLFFBQVMsVUFBdkUsRUFBa0ZTLEdBQWxGLENBQXNGQyxRQUF0RixDQUErRkM7QUFEOUcsR0FGSixFQU1HQyxJQU5ILENBT0k7QUFDRUMsSUFBQUEsSUFBSSxFQUFFUCxRQUFRLENBQUMsQ0FBRCxDQURoQjtBQUVFUSxJQUFBQSxHQUFHLEVBQUU7QUFGUCxHQVBKLEVBWUdULElBWkgsQ0FhSVUsU0FBUyxJQUNQLDBDQUNFekIsSUFERixFQUVFQyxnQkFGRixFQUdFQyxZQUhGLEVBSUVDLGNBSkYsRUFLRUMsZUFMRixFQU1FcUIsU0FORixFQU9FcEIsU0FQRixFQVFFTixlQVJGLENBZE4sQ0FIQyxDQUFQO0FBNkJDLENBeENIOztlQTBDZUEsZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfZGVidWcgZnJvbSAnZGVidWcnXG5cbmltcG9ydCBjb250aW51ZUZhY3RvcnlSZWdpc3RyYXRpb24gZnJvbSAnLi9jb250aW51ZS1mYWN0b3J5LXJlZ2lzdHJhdGlvbidcblxuY29uc3QgZGVidWcgPSBfZGVidWcoJ2NhdGVycGlsbGFycWw6bW9kZWw6cmVnaXN0ZXItZmFjdG9yeScpXG5cbmNvbnN0IHJlZ2lzdGVyRmFjdG9yeSA9IChcbiAgd2ViMyxcbiAgcmVnaXN0cnlDb250cmFjdCxcbiAgY3VycmVudEluZGV4LFxuICBzb3J0ZWRFbGVtZW50cyxcbiAgb3V0cHV0Q29udHJhY3RzLFxuICBtb2RlbEluZm8sXG4pID0+IHtcbiAgZGVidWcoJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpXG4gIGNvbnN0IGZhY3RvcnlDb250cmFjdCA9IG5ldyB3ZWIzLmV0aC5Db250cmFjdChvdXRwdXRDb250cmFjdHNbbW9kZWxJbmZvLmlkXVtgJHtzb3J0ZWRFbGVtZW50c1tjdXJyZW50SW5kZXhdLm5vZGVOYW1lfV9GYWN0b3J5YF0uYWJpKTtcbiAgZmFjdG9yeUNvbnRyYWN0LnRyYW5zYWN0aW9uQ29uZmlybWF0aW9uQmxvY2tzID0gMTtcbiAgcmV0dXJuIHdlYjMuZXRoLnBlcnNvbmFsLmdldEFjY291bnRzKClcbiAgICAudGhlbihcbiAgICAgIGFjY291bnRzID0+XG4gICAgICAgIGZhY3RvcnlDb250cmFjdFxuICAgICAgICAgIC5kZXBsb3koXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGRhdGE6IFwiMHhcIiArIG91dHB1dENvbnRyYWN0c1ttb2RlbEluZm8uaWRdW2Ake3NvcnRlZEVsZW1lbnRzW2N1cnJlbnRJbmRleF0ubm9kZU5hbWV9X0ZhY3RvcnlgXS5ldm0uYnl0ZWNvZGUub2JqZWN0LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICApXG4gICAgICAgICAgLnNlbmQoXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGZyb206IGFjY291bnRzWzBdLFxuICAgICAgICAgICAgICBnYXM6IDQ3MDAwMDAuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIClcbiAgICAgICAgICAudGhlbihcbiAgICAgICAgICAgIGNvbnRyYWN0RiA9PlxuICAgICAgICAgICAgICBjb250aW51ZUZhY3RvcnlSZWdpc3RyYXRpb24oXG4gICAgICAgICAgICAgICAgd2ViMyxcbiAgICAgICAgICAgICAgICByZWdpc3RyeUNvbnRyYWN0LFxuICAgICAgICAgICAgICAgIGN1cnJlbnRJbmRleCxcbiAgICAgICAgICAgICAgICBzb3J0ZWRFbGVtZW50cyxcbiAgICAgICAgICAgICAgICBvdXRwdXRDb250cmFjdHMsXG4gICAgICAgICAgICAgICAgY29udHJhY3RGLFxuICAgICAgICAgICAgICAgIG1vZGVsSW5mbyxcbiAgICAgICAgICAgICAgICByZWdpc3RlckZhY3RvcnksXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgKVxuICB9O1xuXG5leHBvcnQgZGVmYXVsdCByZWdpc3RlckZhY3RvcnlcbiJdfQ==