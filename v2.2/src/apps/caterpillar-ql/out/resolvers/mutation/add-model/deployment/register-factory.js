"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _debug2 = _interopRequireDefault(require("debug"));

var _continueFactoryRegistration = _interopRequireDefault(require("./continue-factory-registration"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var debug = (0, _debug2["default"])('caterpillarql:add-model:register-factory');

var registerFactory = function registerFactory(web3, registryContract, currentIndex, sortedElements, outputContracts, modelInfo) {
  debug('------------------------------------------------------------------------');
  var factoryContract = new web3.eth.Contract(outputContracts[modelInfo.id]["".concat(sortedElements[currentIndex].nodeName, "_Factory")].abi);
  factoryContract.transactionConfirmationBlocks = 1;
  return web3.eth.personal.getAccounts().then(function (accounts) {
    return factoryContract.deploy({
      data: "0x" + outputContracts[modelInfo.id]["".concat(sortedElements[currentIndex].nodeName, "_Factory")].evm.bytecode.object
    }).send({
      from: accounts[0],
      gas: 4700000.
    }).then(function (contractF) {
      return (0, _continueFactoryRegistration["default"])(web3, registryContract, currentIndex, sortedElements, outputContracts, contractF, modelInfo, registerFactory);
    });
  });
};

var _default = registerFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2FwcC9yZXNvbHZlcnMvbXV0YXRpb24vYWRkLW1vZGVsL2RlcGxveW1lbnQvcmVnaXN0ZXItZmFjdG9yeS50cyJdLCJuYW1lcyI6WyJkZWJ1ZyIsInJlZ2lzdGVyRmFjdG9yeSIsIndlYjMiLCJyZWdpc3RyeUNvbnRyYWN0IiwiY3VycmVudEluZGV4Iiwic29ydGVkRWxlbWVudHMiLCJvdXRwdXRDb250cmFjdHMiLCJtb2RlbEluZm8iLCJmYWN0b3J5Q29udHJhY3QiLCJldGgiLCJDb250cmFjdCIsImlkIiwibm9kZU5hbWUiLCJhYmkiLCJ0cmFuc2FjdGlvbkNvbmZpcm1hdGlvbkJsb2NrcyIsInBlcnNvbmFsIiwiZ2V0QWNjb3VudHMiLCJ0aGVuIiwiYWNjb3VudHMiLCJkZXBsb3kiLCJkYXRhIiwiZXZtIiwiYnl0ZWNvZGUiLCJvYmplY3QiLCJzZW5kIiwiZnJvbSIsImdhcyIsImNvbnRyYWN0RiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOzs7O0FBRUEsSUFBTUEsS0FBSyxHQUFHLHdCQUFPLDBDQUFQLENBQWQ7O0FBRUEsSUFBTUMsZUFBZSxHQUFHLFNBQWxCQSxlQUFrQixDQUFDQyxJQUFELEVBQU9DLGdCQUFQLEVBQXlCQyxZQUF6QixFQUF1Q0MsY0FBdkMsRUFBdURDLGVBQXZELEVBQXdFQyxTQUF4RSxFQUFzRjtBQUM1R1AsRUFBQUEsS0FBSyxDQUFDLDBFQUFELENBQUw7QUFDQSxNQUFNUSxlQUFlLEdBQUcsSUFBSU4sSUFBSSxDQUFDTyxHQUFMLENBQVNDLFFBQWIsQ0FBc0JKLGVBQWUsQ0FBQ0MsU0FBUyxDQUFDSSxFQUFYLENBQWYsV0FBaUNOLGNBQWMsQ0FBQ0QsWUFBRCxDQUFkLENBQTZCUSxRQUE5RCxlQUFrRkMsR0FBeEcsQ0FBeEI7QUFDQUwsRUFBQUEsZUFBZSxDQUFDTSw2QkFBaEIsR0FBZ0QsQ0FBaEQ7QUFDQSxTQUFPWixJQUFJLENBQUNPLEdBQUwsQ0FBU00sUUFBVCxDQUFrQkMsV0FBbEIsR0FDSkMsSUFESSxDQUVILFVBQUFDLFFBQVE7QUFBQSxXQUNOVixlQUFlLENBQ1pXLE1BREgsQ0FFSTtBQUNFQyxNQUFBQSxJQUFJLEVBQUUsT0FBT2QsZUFBZSxDQUFDQyxTQUFTLENBQUNJLEVBQVgsQ0FBZixXQUFpQ04sY0FBYyxDQUFDRCxZQUFELENBQWQsQ0FBNkJRLFFBQTlELGVBQWtGUyxHQUFsRixDQUFzRkMsUUFBdEYsQ0FBK0ZDO0FBRDlHLEtBRkosRUFNR0MsSUFOSCxDQU9JO0FBQ0VDLE1BQUFBLElBQUksRUFBRVAsUUFBUSxDQUFDLENBQUQsQ0FEaEI7QUFFRVEsTUFBQUEsR0FBRyxFQUFFO0FBRlAsS0FQSixFQVlHVCxJQVpILENBYUksVUFBQVUsU0FBUztBQUFBLGFBQ1AsNkNBQ0V6QixJQURGLEVBRUVDLGdCQUZGLEVBR0VDLFlBSEYsRUFJRUMsY0FKRixFQUtFQyxlQUxGLEVBTUVxQixTQU5GLEVBT0VwQixTQVBGLEVBUUVOLGVBUkYsQ0FETztBQUFBLEtBYmIsQ0FETTtBQUFBLEdBRkwsQ0FBUDtBQTZCQyxDQWpDSDs7ZUFtQ2VBLGUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgX2RlYnVnIGZyb20gJ2RlYnVnJ1xuXG5pbXBvcnQgY29udGludWVGYWN0b3J5UmVnaXN0cmF0aW9uIGZyb20gJy4vY29udGludWUtZmFjdG9yeS1yZWdpc3RyYXRpb24nXG5cbmNvbnN0IGRlYnVnID0gX2RlYnVnKCdjYXRlcnBpbGxhcnFsOmFkZC1tb2RlbDpyZWdpc3Rlci1mYWN0b3J5JylcblxuY29uc3QgcmVnaXN0ZXJGYWN0b3J5ID0gKHdlYjMsIHJlZ2lzdHJ5Q29udHJhY3QsIGN1cnJlbnRJbmRleCwgc29ydGVkRWxlbWVudHMsIG91dHB1dENvbnRyYWN0cywgbW9kZWxJbmZvKSA9PiB7XG4gIGRlYnVnKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKVxuICBjb25zdCBmYWN0b3J5Q29udHJhY3QgPSBuZXcgd2ViMy5ldGguQ29udHJhY3Qob3V0cHV0Q29udHJhY3RzW21vZGVsSW5mby5pZF1bYCR7c29ydGVkRWxlbWVudHNbY3VycmVudEluZGV4XS5ub2RlTmFtZX1fRmFjdG9yeWBdLmFiaSk7XG4gIGZhY3RvcnlDb250cmFjdC50cmFuc2FjdGlvbkNvbmZpcm1hdGlvbkJsb2NrcyA9IDE7XG4gIHJldHVybiB3ZWIzLmV0aC5wZXJzb25hbC5nZXRBY2NvdW50cygpXG4gICAgLnRoZW4oXG4gICAgICBhY2NvdW50cyA9PlxuICAgICAgICBmYWN0b3J5Q29udHJhY3RcbiAgICAgICAgICAuZGVwbG95KFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBkYXRhOiBcIjB4XCIgKyBvdXRwdXRDb250cmFjdHNbbW9kZWxJbmZvLmlkXVtgJHtzb3J0ZWRFbGVtZW50c1tjdXJyZW50SW5kZXhdLm5vZGVOYW1lfV9GYWN0b3J5YF0uZXZtLmJ5dGVjb2RlLm9iamVjdCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgKVxuICAgICAgICAgIC5zZW5kKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBmcm9tOiBhY2NvdW50c1swXSxcbiAgICAgICAgICAgICAgZ2FzOiA0NzAwMDAwLlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICApXG4gICAgICAgICAgLnRoZW4oXG4gICAgICAgICAgICBjb250cmFjdEYgPT5cbiAgICAgICAgICAgICAgY29udGludWVGYWN0b3J5UmVnaXN0cmF0aW9uKFxuICAgICAgICAgICAgICAgIHdlYjMsXG4gICAgICAgICAgICAgICAgcmVnaXN0cnlDb250cmFjdCxcbiAgICAgICAgICAgICAgICBjdXJyZW50SW5kZXgsXG4gICAgICAgICAgICAgICAgc29ydGVkRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgb3V0cHV0Q29udHJhY3RzLFxuICAgICAgICAgICAgICAgIGNvbnRyYWN0RixcbiAgICAgICAgICAgICAgICBtb2RlbEluZm8sXG4gICAgICAgICAgICAgICAgcmVnaXN0ZXJGYWN0b3J5LFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgIClcbiAgfTtcblxuZXhwb3J0IGRlZmF1bHQgcmVnaXN0ZXJGYWN0b3J5XG4iXX0=