"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _nestedContracts = _interopRequireDefault(require("./nested-contracts"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const findParameters = (contractAbi, functionName) => {
  let jsonAbi = JSON.parse(contractAbi);
  let candidates = [];
  jsonAbi.forEach(element => {
    if (element.name === functionName) {
      candidates = element.inputs;
    }
  });
  let res = [];
  candidates.forEach(element => {
    if (element.name && element.name !== 'workitemId') res.push(element);
  });
  return res;
};

var _default = ({
  web3,
  bpmnModel,
  registryContract
}) => async contractAddress => {
  const nestedContracts = await (0, _nestedContracts.default)({
    web3,
    registryContract
  })(contractAddress);
  const x = await Promise.all(nestedContracts.map(async ({
    bundleId,
    contractAddress,
    abi,
    indexToElement,
    worklistAbi,
    worklistAddress,
    worklistInstance,
    startedActivities,
    startedInstances
  }) => Promise.all(startedActivities.map(async (startedActivity, index) => {
    if (startedActivity === '1' && indexToElement[index].type === 'Workitem') {
      const reqInd = await worklistInstance.methods.workItemsFor(index, contractAddress).call().then(x => web3.utils.toBN(x).toString(2).split('').reverse());
      const ret = await Promise.all(reqInd.map(async (req, i) => {
        if (req === '1') {
          return {
            bundleId: bundleId,
            elementId: indexToElement[index].id,
            elementName: indexToElement[index].name,
            hrefs: [`/workitems/${worklistAddress}/${i}`],
            input: findParameters(worklistAbi, indexToElement[index].name),
            pcases: [await worklistInstance.methods.processInstanceFor(i).call()],
            processAddress: contractAddress
          };
        }
      }));
      return ret;
    } // return Promise.resolve()

  }))));
  const workItems = x.reduce((acc, items) => [...acc, ...(items || [])], []).reduce((acc, items) => [...acc, ...(items || [])], []).filter(x => x).map((item, index) => _objectSpread({}, item, {
    index
  })).reduce((acc, item) => {
    const exists = acc.find(({
      elementId,
      bundleId
    }) => elementId === item.elementId && bundleId === item.bundleId);

    if (exists) {
      return [...acc.filter(a => a !== exists), _objectSpread({}, exists, {
        hrefs: [...exists.hrefs, ...item.hrefs],
        pcases: [...exists.pcases, ...item.pcases]
      })];
    }

    return [...acc, item];
  }, []).sort(({
    index
  }) => index);
  return {
    bpmn: bpmnModel,
    workItems
  };
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2FwcC9yZXNvbHZlcnMvcHJvY2Vzcy1jb250cmFjdC9pbnN0YW5jZS1zdGF0ZS9pbmRleC50cyJdLCJuYW1lcyI6WyJmaW5kUGFyYW1ldGVycyIsImNvbnRyYWN0QWJpIiwiZnVuY3Rpb25OYW1lIiwianNvbkFiaSIsIkpTT04iLCJwYXJzZSIsImNhbmRpZGF0ZXMiLCJmb3JFYWNoIiwiZWxlbWVudCIsIm5hbWUiLCJpbnB1dHMiLCJyZXMiLCJwdXNoIiwid2ViMyIsImJwbW5Nb2RlbCIsInJlZ2lzdHJ5Q29udHJhY3QiLCJjb250cmFjdEFkZHJlc3MiLCJuZXN0ZWRDb250cmFjdHMiLCJ4IiwiUHJvbWlzZSIsImFsbCIsIm1hcCIsImJ1bmRsZUlkIiwiYWJpIiwiaW5kZXhUb0VsZW1lbnQiLCJ3b3JrbGlzdEFiaSIsIndvcmtsaXN0QWRkcmVzcyIsIndvcmtsaXN0SW5zdGFuY2UiLCJzdGFydGVkQWN0aXZpdGllcyIsInN0YXJ0ZWRJbnN0YW5jZXMiLCJzdGFydGVkQWN0aXZpdHkiLCJpbmRleCIsInR5cGUiLCJyZXFJbmQiLCJtZXRob2RzIiwid29ya0l0ZW1zRm9yIiwiY2FsbCIsInRoZW4iLCJ1dGlscyIsInRvQk4iLCJ0b1N0cmluZyIsInNwbGl0IiwicmV2ZXJzZSIsInJldCIsInJlcSIsImkiLCJlbGVtZW50SWQiLCJpZCIsImVsZW1lbnROYW1lIiwiaHJlZnMiLCJpbnB1dCIsInBjYXNlcyIsInByb2Nlc3NJbnN0YW5jZUZvciIsInByb2Nlc3NBZGRyZXNzIiwid29ya0l0ZW1zIiwicmVkdWNlIiwiYWNjIiwiaXRlbXMiLCJmaWx0ZXIiLCJpdGVtIiwiZXhpc3RzIiwiZmluZCIsImEiLCJzb3J0IiwiYnBtbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7Ozs7OztBQUdBLE1BQU1BLGNBQWMsR0FBRyxDQUFDQyxXQUFELEVBQWNDLFlBQWQsS0FBK0I7QUFDcEQsTUFBSUMsT0FBTyxHQUFHQyxJQUFJLENBQUNDLEtBQUws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Q04sR0FBR1MsTUFBTSxDQUFDVCxNQURKLEVBRU4sR0FBR1EsSUFBSSxDQUFDUixNQUZGO0FBUkwsU0FBUDtBQWNEOztBQUNELFdBQU8sQ0FDTCxHQUFHSyxHQURFLEVBRUxHLElBRkssQ0FBUDtBQUtELEdBbERhLEVBbURkLEVBbkRjLEVBcURmSSxJQXJEZSxDQXNEZCxDQUFDO0FBQUVoQyxJQUFBQTtBQUFGLEdBQUQsS0FBZUEsS0F0REQsQ0FBbEI7QUF3REEsU0FBTztBQUFFaUMsSUFBQUEsSUFBSSxFQUFFbEQsU0FBUjtBQUFtQndDLElBQUFBO0FBQW5CLEdBQVA7QUFDRCxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGdldE5lc3RlZENvbnRyYWN0cyBmcm9tICcuL25lc3RlZC1jb250cmFjdHMnXG5cblxuY29uc3QgZmluZFBhcmFtZXRlcnMgPSAoY29udHJhY3RBYmksIGZ1bmN0aW9uTmFtZSkgPT4ge1xuICBsZXQganNvbkFiaSA9IEpTT04ucGFyc2UoY29udHJhY3RBYmkpO1xuICBsZXQgY2FuZGlkYXRlcyA9IFtdO1xuICBqc29uQWJpLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICBpZiAoZWxlbWVudC5uYW1lID09PSBmdW5jdGlvbk5hbWUpIHtcbiAgICAgICAgICBjYW5kaWRhdGVzID0gZWxlbWVudC5pbnB1dHM7XG4gICAgICB9XG4gIH0pO1xuICBsZXQgcmVzID0gW107XG4gIGNhbmRpZGF0ZXMuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgIGlmIChlbGVtZW50Lm5hbWUgJiYgZWxlbWVudC5uYW1lICE9PSAnd29ya2l0ZW1JZCcpXG4gICAgICAgICAgcmVzLnB1c2goZWxlbWVudCk7XG4gIH0pO1xuICByZXR1cm4gcmVzO1xufTtcblxuXG5leHBvcnQgZGVmYXVsdCAoe1xuICB3ZWIzLFxuICBicG1uTW9kZWwsXG4gIHJlZ2lzdHJ5Q29udHJhY3QsXG59KTogRnVuY3Rpb24gPT4gYXN5bmMgKFxuICBjb250cmFjdEFkZHJlc3MsXG4pOiBQcm9taXNlPGFueT4gPT4ge1xuICBjb25zdCBuZXN0ZWRDb250cmFjdHMgPSBhd2FpdCBnZXROZXN0ZWRDb250cmFjdHMoe1xuICAgIHdlYjMsXG4gICAgcmVnaXN0cnlDb250cmFjdCwgIFxuICB9KShjb250cmFjdEFkZHJlc3MpXG5cbiAgY29uc3QgeCA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgIG5lc3RlZENvbnRyYWN0c1xuICAgICAgLm1hcChcbiAgICAgICAgYXN5bmMgKHtcbiAgICAgICAgICBidW5kbGVJZCxcbiAgICAgICAgICBjb250cmFjdEFkZHJlc3MsXG4gICAgICAgICAgYWJpLFxuICAgICAgICAgIGluZGV4VG9FbGVtZW50LFxuICAgICAgICAgIHdvcmtsaXN0QWJpLFxuICAgICAgICAgIHdvcmtsaXN0QWRkcmVzcyxcbiAgICAgICAgICB3b3JrbGlzdEluc3RhbmNlLFxuICAgICAgICAgIHN0YXJ0ZWRBY3Rpdml0aWVzLFxuICAgICAgICAgIHN0YXJ0ZWRJbnN0YW5jZXMsXG4gICAgICAgIH0pOiBQcm9taXNlPGFueT4gPT4gUHJvbWlzZS5hbGwoXG4gICAgICAgICAgc3RhcnRlZEFjdGl2aXRpZXNcbiAgICAgICAgICAgIC5tYXAoXG4gICAgICAgICAgICAgIGFzeW5jIChcbiAgICAgICAgICAgICAgICBzdGFydGVkQWN0aXZpdHksXG4gICAgICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICAgICk6IFByb21pc2U8YW55PiA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0ZWRBY3Rpdml0eSA9PT0gJzEnICYmIGluZGV4VG9FbGVtZW50W2luZGV4XS50eXBlID09PSAnV29ya2l0ZW0nKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCByZXFJbmQgPSBhd2FpdCB3b3JrbGlzdEluc3RhbmNlLm1ldGhvZHMud29ya0l0ZW1zRm9yKGluZGV4LCBjb250cmFjdEFkZHJlc3MpLmNhbGwoKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihcbiAgICAgICAgICAgICAgICAgICAgICAoeCk6IGFueSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgd2ViMy51dGlscy50b0JOKHgpLnRvU3RyaW5nKDIpLnNwbGl0KCcnKS5yZXZlcnNlKCksXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgICAgICAgICAgICAgIHJlcUluZFxuICAgICAgICAgICAgICAgICAgICAgIC5tYXAoXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3luYyAocmVxLCBpKTogUHJvbWlzZTxhbnk+ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcSA9PT0gJzEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1bmRsZUlkOiBidW5kbGVJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRJZDogaW5kZXhUb0VsZW1lbnRbaW5kZXhdLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudE5hbWU6IGluZGV4VG9FbGVtZW50W2luZGV4XS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHJlZnM6IFtgL3dvcmtpdGVtcy8ke3dvcmtsaXN0QWRkcmVzc30vJHtpfWBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IGZpbmRQYXJhbWV0ZXJzKHdvcmtsaXN0QWJpLCBpbmRleFRvRWxlbWVudFtpbmRleF0ubmFtZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwY2FzZXM6IFsgYXdhaXQgd29ya2xpc3RJbnN0YW5jZS5tZXRob2RzLnByb2Nlc3NJbnN0YW5jZUZvcihpKS5jYWxsKCldLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0FkZHJlc3M6IGNvbnRyYWN0QWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmV0XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHJldHVybiBQcm9taXNlLnJlc29sdmUoKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgICksXG4gICAgICApXG4gIClcbiAgY29uc3Qgd29ya0l0ZW1zID0geFxuICAgIC5yZWR1Y2UoXG4gICAgICAoYWNjLCBpdGVtcykgPT4gW1xuICAgICAgICAuLi5hY2MsXG4gICAgICAgIC4uLml0ZW1zIHx8IFtdLFxuICAgICAgXSxcbiAgICAgIFtdLFxuICAgIClcbiAgICAucmVkdWNlKFxuICAgICAgKGFjYywgaXRlbXMpID0+IFtcbiAgICAgICAgLi4uYWNjLFxuICAgICAgICAuLi5pdGVtcyB8fCBbXSxcbiAgICAgIF0sXG4gICAgICBbXSxcbiAgICApXG4gICAgLmZpbHRlcih4ID0+IHgpXG4gICAgLm1hcChcbiAgICAgIChpdGVtLCBpbmRleCkgPT4gKHtcbiAgICAgICAgLi4uaXRlbSxcbiAgICAgICAgaW5kZXgsXG4gICAgICB9KVxuICAgIClcbiAgICAucmVkdWNlKFxuICAgICAgKGFjYywgaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBleGlzdHMgPSBhY2MuZmluZChcbiAgICAgICAgICAoeyBlbGVtZW50SWQsIGJ1bmRsZUlkIH0pID0+XG4gICAgICAgICAgICBlbGVtZW50SWQgPT09IGl0ZW0uZWxlbWVudElkICYmXG4gICAgICAgICAgICAgIGJ1bmRsZUlkID09PSBpdGVtLmJ1bmRsZUlkLFxuICAgICAgICApXG4gICAgICAgIGlmIChleGlzdHMpIHtcbiAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgLi4uYWNjLmZpbHRlcihhID0+IGEgIT09IGV4aXN0cyksXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIC4uLmV4aXN0cyxcbiAgICAgICAgICAgICAgaHJlZnM6W1xuICAgICAgICAgICAgICAgIC4uLmV4aXN0cy5ocmVmcyxcbiAgICAgICAgICAgICAgICAuLi5pdGVtLmhyZWZzLFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICBwY2FzZXM6IFtcbiAgICAgICAgICAgICAgICAuLi5leGlzdHMucGNhc2VzLFxuICAgICAgICAgICAgICAgIC4uLml0ZW0ucGNhc2VzLFxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgLi4uYWNjLFxuICAgICAgICAgIGl0ZW0sXG4gICAgICAgIF0gIFxuICAgICAgICBcbiAgICAgIH0sXG4gICAgICBbXSxcbiAgICApXG4gICAgLnNvcnQoXG4gICAgICAoeyBpbmRleCB9KSA9PiBpbmRleCxcbiAgICApXG4gIHJldHVybiB7IGJwbW46IGJwbW5Nb2RlbCwgd29ya0l0ZW1zIH1cbn1cbiJdfQ==